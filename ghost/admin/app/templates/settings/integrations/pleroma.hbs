<section class="gh-canvas">
    <GhCanvasHeader class="gh-canvas-header sticky">
        <div class="flex flex-column">
            <div class="gh-canvas-breadcrumb">
                <LinkTo @route="settings">
                    Settings
                </LinkTo>
                {{svg-jar "arrow-right-small"}}
                <LinkTo @route="settings.integrations" data-test-link="integrations-back">
                    Integrations
                </LinkTo>
                {{svg-jar "arrow-right-small"}} pleroma
            </div>
        </div>
        <section class="view-actions">
            <GhTaskButton @task={{this.saveTask}} @class="gh-btn gh-btn-primary gh-btn-icon" data-test-save-button={{true}} />
        </section>
    </GhCanvasHeader>

    <section class="view-container">
        <section class="gh-main-section app-grid">
            <div class="gh-main-section-block app-detail-heading app-grid">
                <div class="app-cell">
                    <!--<img class="app-icon" src="assets/img/pleromaicon.png" />-->
                </div>
                <div class="app-cell">
                    <h3>Pleroma</h3>
                    <p>ActivityPub server</p>
                </div>
            </div>
        </section>

        <section class="gh-main-section">
            <h4 class="gh-main-section-header small bn">Pleroma Bot configuration</h4>
            <div class="gh-main-section-block">
                <div class="gh-main-section-content grey">
                    <form class="app-config-form" id="pleroma-settings" novalidate="novalidate" {{action "save" on="submit"}}>

                        <div class="gh-main-section-block">
                            <div class="gh-setting-first">
                                <div class="gh-setting-content gh-setting-content--no-action">
                                    <div class="gh-setting-title">Instance URL</div>
                                    <div class="gh-setting-desc">Automatically toot published Ghost posts to your Pleroma ActivityPub feed</div>
                                    <div class="gh-setting-content-extended">
                                        <GhFormGroup @errors={{this.settings.errors}} @hasValidated={{this.settings.hasValidated}} @property="pleromaUrl">
                                            <GhTextInput
                                                @placeholder="https://hooks.pleroma.com/services/..."
                                                @name="pleroma_url"
                                                @value={{readonly this.settings.pleromaUrl}}
                                                @input={{action (mut this.settings.pleromaUrl) value="target.value"}}
                                                @focus-out={{action "validate" "pleromaUrl" target=this.settings}}
                                                @keyEvents={{hash
                                                    Enter=(action "save")
                                                }}
                                                data-test-pleroma-url-input={{true}}
                                            />
                                            {{#unless this.settings.errors}}
                                                <p>Set up a new incoming webhook <a href="https://my.pleroma.com/apps/new/A0F7XDUAZ-incoming-webhooks" target="_blank" rel="noopener noreferrer">here</a>, and grab the URL.</p>
                                            {{else}}
                                                <GhErrorMessage @errors={{this.settings.errors}} @property="pleromaUrl" data-test-error="pleroma-url" />
                                            {{/unless}}
                                        </GhFormGroup>
                                    </div>
                                </div>
                            </div>
                            <div class="gh-setting-last">
                                <div class="gh-setting-content gh-setting-content--no-action">
                                    <div class="gh-setting-title">Username</div>
                                    <div class="gh-setting-desc">The username of the bot account used to publish toots</div>
                                    <div class="gh-setting-content-extended">
                                        <GhFormGroup @errors={{this.settings.errors}} @hasValidated={{this.settings.hasValidated}} @property="username">
                                            <GhTextInput
                                                @placeholder="Ghost"
                                                @name="pleroma_username"
                                                @value={{readonly this.settings.pleromaUsername}}
                                                @input={{action (mut this.settings.pleromaUsername) value="target.value"}}
                                                @keyEvents={{hash
                                                    Enter=(action "save")
                                                }}
                                                data-test-pleroma-username-input={{true}}
                                            />
                                            {{#if this.settings.errors}}
                                                <GhErrorMessage @errors={{this.settings.errors}} @property="pleromaUsername" />
                                            {{/if}}
                                        </GhFormGroup>
                                    </div>
                                </div>
                            </div>

                            <div class="gh-setting-last">
                                <div class="gh-setting-content gh-setting-content--no-action">
                                    <div class="gh-setting-title">Password</div>
                                    <div class="gh-setting-desc">The password of the bot account</div>
                                    <div class="gh-setting-content-extended">
                                        <GhFormGroup @errors={{this.settings.errors}} @hasValidated={{this.settings.hasValidated}} @property="password">
                                            <GhTextInput
                                                @placeholder="password"
                                                @name="pleroma_password"
                                                @value={{readonly this.settings.pleromaPassword}}
                                                @input={{action (mut this.settings.pleromaPassword) value="target.value"}}
                                                @keyEvents={{hash
                                                    Enter=(action "save")
                                                }}
                                                data-test-pleroma-password-input={{true}}
                                            />
                                            {{#if this.settings.errors}}
                                                <GhErrorMessage @errors={{this.settings.errors}} @property="pleromaPassword" />
                                            {{/if}}
                                        </GhFormGroup>
                                    </div>
                                    <GhTaskButton @buttonText="Send test notification" @task={{this.sendTestNotification}} @successText="Sent" @class="gh-btn gh-btn-icon" data-test-send-notification-button="true" />
                                </div>
                            </div>

                        </div>
                    </form>
                </div>
            </div>
        </section>
    </section>
</section>
